<view class="chatInterface"><view class="scroll-view"><view class="all-history-loaded">{{allHistoryLoaded?'已经没有更多的历史消息':'下拉获取历史消息'}}</view><block wx:for="{{$root.l0}}" wx:for-item="message" wx:for-index="index" wx:key="messageId"><view><view class="time-lag">{{message.m0}}</view><view class="{{['message-item',(message.$orig.senderId==(currentUser&&currentUser.uuid))?'self':'']}}"><block wx:if="{{message.$orig.senderId!=(currentUser&&currentUser.uuid)}}"><view class="avatar"><image src="{{friend.avatar}}"></image></view></block><block wx:else><view class="avatar"><image src="{{currentUser.avatar}}"></image></view></block><view class="content"><block wx:if="{{message.$orig.status=='sending'}}"><view class="pending _b"></view></block><block wx:if="{{message.$orig.status=='fail'}}"><view class="send-fail _b"></view></block><block wx:if="{{message.$orig.type=='text'}}"><view><rich-text nodes="{{message.m1}}"></rich-text></view></block><block wx:if="{{message.$orig.type=='image'}}"><image class="image-content" src="{{message.$orig.payload.url}}" data-url="{{message.$orig.payload.url}}" mode="widthFix" data-event-opts="{{[['tap',[['showImageFullScreen',['$event']]]]]}}" bindtap="__e"></image></block><block wx:if="{{message.$orig.type=='video'}}"><view class="video-snapshot" data-url="{{message.$orig.payload.video.url}}" data-event-opts="{{[['tap',[['playVideo',['$event']]]]]}}" bindtap="__e"><image src="{{message.$orig.payload.thumbnail.url}}" mode="aspectFit"></image><view class="video-play-icon"></view></view></block><block wx:if="{{message.$orig.type=='audio'}}"><audio-player vue-id="{{'054d6398-1-'+index}}" src="{{message.$orig.payload.url}}" duration="{{message.$orig.payload.duration}}" bind:__l="__l"></audio-player></block><block wx:if="{{message.$orig.type=='order'}}"><view class="custom-message"><view class="title"><text>自定义消息</text></view><view class="custom-message-item">{{"编号："+message.$orig.payload.number}}</view><view class="custom-message-item">{{"商品: "+message.$orig.payload.goods}}</view><view class="custom-message-item">{{"金额: "+message.$orig.payload.price}}</view></view></block></view></view></view></block></view><block wx:if="{{!video.visible}}"><view class="action-box"><view class="action-top"><view data-event-opts="{{[['tap',[['switchAudioKeyboard',['$event']]]]]}}" class="{{[audio.visible?'record-icon record-open':'record-icon']}}" bindtap="__e"></view><block wx:if="{{audio.visible}}"><view data-event-opts="{{[['touchstart',[['onRecordStart',['$event']]]],['touchend',[['onRecordEnd',['$event']]]]]}}" class="record-input" bindtouchstart="__e" bindtouchend="__e">{{audio.recording?'松开发送':'按住录音'}}</view></block><block wx:else><view class="message-input"><input type="text" maxlength="700" placeholder="发送消息" data-event-opts="{{[['focus',[['messageInputFocusin',['$event']]]],['input',[['__set_model',['','content','$event',[]]]]]]}}" value="{{content}}" bindfocus="__e" bindinput="__e"/></view></block><view data-event-opts="{{[['tap',[['showEmoji',['$event']]]]]}}" class="file-icon emoji-icon" bindtap="__e"></view><view data-event-opts="{{[['tap',[['showMore',['$event']]]]]}}" class="file-icon more-icon" bindtap="__e"></view><label data-event-opts="{{[['tap',[['sendTextMessage',['$event']]]]]}}" class="send-message-btn _span" bindtap="__e">发送</label></view><block wx:if="{{emoji.show}}"><view class="action-bottom" style="justify-content:space-around;"><block wx:for="{{emoji.map}}" wx:for-item="emojiItem" wx:for-index="emojiKey" wx:key="*this"><image class="emoji-item" src="{{emoji.url+emojiItem}}" data-event-opts="{{[['tap',[['selectEmoji',[emojiKey]]]]]}}" bindtap="__e"></image></block></view></block><block wx:if="{{more.show}}"><view class="action-bottom"><view data-event-opts="{{[['tap',[['sendImage',['$event']]]]]}}" class="more-item" bindtap="__e"><image src="/static/image/chat/tupian.png"></image><text>图片</text></view><view data-event-opts="{{[['tap',[['sendVideo',['$event']]]]]}}" class="more-item" bindtap="__e"><image src="/static/image/chat/shipin.png"></image><text>视频</text></view></view></block></view></block><block wx:if="{{audio.recording}}"><view class="record-loading"></view></block><block wx:if="{{video.visible}}"><video src="{{video.url}}" id="videoPlayer" data-event-opts="{{[['fullscreenchange',[['onVideoFullScreenChange',['$event']]]]]}}" bindfullscreenchange="__e"></video></block></view>