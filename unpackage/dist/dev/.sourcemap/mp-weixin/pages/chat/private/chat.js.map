{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?fc09","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?8ac3","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?d93e","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?472c","uni-app:///pages/chat/private/chat.vue","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?7206","webpack:///C:/Users/IT/Desktop/共享旅途/mini/pages/chat/private/chat.vue?7735"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,kG,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACa;;;AAGhE;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,0MAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACrDA;AAAA;AAAA;AAAA;AAAgnB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsEpoB,yG;AACA,+C;;AAEA;AACA,qBADA;AAEA;AACA,4BADA,EAFA;;AAKA,MALA,kBAKA;AACA;AACA;AACA,+BADA;AAEA,8BAFA;AAGA,8BAHA;AAIA,8BAJA;AAKA,8BALA;AAMA,8BANA;;AAQA;AACA;AACA,iBAFA;AAGA,kBAHA;AAIA,uBAJA;AAKA;AACA,kBANA;AAOA;AACA,6BARA;;AAUA;AACA;AACA,qBADA;AAEA,qBAFA;AAGA,mBAHA;AAIA,8DAJA,EAXA;;AAiBA;AACA;AACA,mBAFA,EAjBA;;AAqBA;AACA;AACA,wBAFA;AAGA;AACA,sBAJA,EArBA;;AA2BA;AACA,sBADA;AAEA,eAFA;AAGA,qBAHA,EA3BA;;;AAiCA,GAhDA;AAiDA,SAjDA,qBAiDA;AACA;AACA;AACA;;;AAGA,GAvDA;AAwDA,QAxDA,oBAwDA;AACA;AACA;AACA,GA3DA;AA4DA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA,mBAvFA,6BAuFA,CAvFA,EAuFA;AACA;AACA,GAzFA;AA0FA,UA1FA,sBA0FA;AACA;AACA;AACA;AACA;AACA;AACA,GAhGA;AAiGA;AACA;AACA;AACA,qBAHA,6BAGA,OAHA,EAGA;AACA;AACA,KALA;AAMA;AACA;AACA,qBARA,6BAQA,OARA,EAQA,KARA,EAQA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAjBA;AAkBA,yBAlBA,mCAkBA;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA;AACA;AACA;AACA;AACA,iCADA;AAEA,+CAFA;AAGA;AACA,qCADA;AAEA,yCAFA,EAHA,EADA;;;AASA,mBATA;AAUA;AACA;AACA,WAZA;AAaA;AACA,oDADA;AAEA,0BAFA,CAEA;AAFA,WAbA;;AAkBA;AACA,OArBA;AAsBA;AACA;AACA;AACA,OAFA;AAGA,KAlDA;AAmDA,eAnDA,uBAmDA,OAnDA,EAmDA;AACA;AACA;AACA;AACA;AACA;AACA,wBADA;AAEA;AACA;AACA,SAJA;AAKA;AACA;AACA,SAPA;;AASA,KAjEA;AAkEA,mBAlEA,6BAkEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA;AAEA;AACA,gCADA;AAEA,8CAFA;AAGA;AACA,oCADA;AAEA,wCAFA,EAHA,EAFA;;;AAUA;AACA,mDADA;AAEA,sBAFA,EAVA;;;AAeA;AACA;AACA;AACA;AACA,KA5FA;AA6FA,0BA7FA,oCA6FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCADA;AAEA,2CAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAjBA;AAkBA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA,SA1BA;;AA4BA,KAlIA;AAmIA;AACA,uBApIA,iCAoIA;AACA;AACA;AACA;AACA,+BADA;;AAGA;AACA,KA3IA;AA4IA,iBA5IA,2BA4IA;AACA;AACA;AACA,OAFA,CAEA;AACA;AACA,uBADA;AAEA,+EAFA;;AAIA;AACA,KArJA;AAsJA,eAtJA,yBAsJA;AACA;AACA;AACA,OAFA,CAEA;AACA;AACA;AACA,KA5JA;AA6JA,aA7JA,uBA6JA;AACA;AACA;AACA;AACA;AACA;AACA,oCADA;AAEA,kDAFA;AAGA;AACA,wCADA;AAEA,4CAFA,EAHA,EADA;;;AASA,qBATA;AAUA;AACA;AACA,aAZA;AAaA;AACA,uDADA;AAEA,4BAFA,CAEA;AAFA,aAbA;;AAkBA;AACA,SArBA;;AAuBA,KAtLA;AAuLA,aAvLA,uBAuLA;AACA;AACA,gBADA;AAEA;AACA;AACA;AACA,oCADA;AAEA,kDAFA;AAGA;AACA,wCADA;AAEA,4CAFA,EAHA,EADA;;;AASA,qBATA;AAUA;AACA;AACA,aAZA;AAaA;AACA,uDADA;AAEA,4BAFA,CAEA;AAFA,aAbA;;AAkBA;AACA,SAtBA;;AAwBA,KAhNA;AAiNA,uBAjNA,+BAiNA,CAjNA,EAiNA;AACA;AACA;AACA,uBADA;;AAGA,KAtNA;AAuNA,aAvNA,qBAuNA,CAvNA,EAuNA;AACA;AACA;AACA;AACA;AACA,sBADA;;AAGA;AACA,OALA;AAMA,KAhOA;AAiOA,2BAjOA,mCAiOA,CAjOA,EAiOA;AACA;AACA;AACA;AACA;AACA;AACA,KAvOA;AAwOA,uBAxOA,iCAwOA;AACA;AACA;AACA,KA3OA;AA4OA,aA5OA,uBA4OA;AACA;AACA;AACA,KA/OA;AAgPA,YAhPA,sBAgPA;AACA;AACA;AACA,KAnPA;AAoPA,eApPA,uBAoPA,QApPA,EAoPA;AACA;AACA,KAtPA;AAuPA,yBAvPA,mCAuPA;AACA;AACA,4BADA;AAEA,8BAFA;AAGA,kCAHA;AAIA,0CAJA;;AAMA;AACA,sEADA;;AAGA,KAjQA;AAkQA,kBAlQA,4BAkQA;AACA;AACA;AACA,4BADA;AAEA,sBAFA;;AAIA,OALA;AAMA,KAzQA;AA0QA,4BA1QA,oCA0QA,QA1QA,EA0QA;AACA;AACA,wBADA;AAEA;AACA;AACA,SAJA;AAKA;AACA;AACA,SAPA;;AASA,KApRA,EAjGA,E;;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAAy4B,CAAgB,m2BAAG,EAAC,C;;;;;;;;;;;ACA75B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/private/chat.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/private/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=423c55dc&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/private/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=423c55dc&\"","var components\ntry {\n  components = {\n    AudioPlayer: function() {\n      return import(\n        /* webpackChunkName: \"components/AudioPlayer/AudioPlayer\" */ \"@/components/AudioPlayer/AudioPlayer.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messages, function(message, index) {\n    var $orig = _vm.__get_orig(message)\n\n    var m0 = _vm.renderMessageDate(message, index)\n    var m1 = message.type == \"text\" ? _vm.renderTextMessage(message) : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"chatInterface\">\r\n\t\t<view class=\"scroll-view\">\r\n\t\t\t<view class=\"all-history-loaded\">{{ allHistoryLoaded ? '已经没有更多的历史消息' : '下拉获取历史消息' }}</view>\r\n\t\t\t<!--已经收到的消息-->\r\n\t\t\t<view v-for=\"(message, index) in messages\" :key=\"message.messageId\">\r\n\t\t\t\t<!--时间显示，类似于微信，隔5分钟不发言，才显示时间-->\r\n\t\t\t\t<view class=\"time-lag\">{{ renderMessageDate(message, index) }}</view>\r\n\t\t\t\t<view class=\"message-item\" :class=\"{ self: message.senderId == (currentUser && currentUser.uuid) }\">\r\n\t\t\t\t\t<view class=\"avatar\" v-if=\"message.senderId != (currentUser && currentUser.uuid)\"><image :src=\"friend.avatar\"></image></view>\r\n\t\t\t\t\t<view class=\"avatar\" v-else><image :src=\"currentUser.avatar\"></image></view>\r\n\t\t\t\t\t<view class=\"content\">\r\n\t\t\t\t\t\t<b class=\"pending\" v-if=\"message.status == 'sending'\"></b>\r\n\t\t\t\t\t\t<b class=\"send-fail\" v-if=\"message.status == 'fail'\"></b>\r\n\t\t\t\t\t\t<view v-if=\"message.type == 'text'\" v-html=\"renderTextMessage(message)\"></view>\r\n\t\t\t\t\t\t<image\r\n\t\t\t\t\t\t\tclass=\"image-content\"\r\n\t\t\t\t\t\t\tv-if=\"message.type == 'image'\"\r\n\t\t\t\t\t\t\t:src=\"message.payload.url\"\r\n\t\t\t\t\t\t\t:data-url=\"message.payload.url\"\r\n\t\t\t\t\t\t\t@click=\"showImageFullScreen\"\r\n\t\t\t\t\t\t\tmode=\"widthFix\"\r\n\t\t\t\t\t\t></image>\r\n\t\t\t\t\t\t<view class=\"video-snapshot\" v-if=\"message.type == 'video'\" :data-url=\"message.payload.video.url\" @click=\"playVideo\">\r\n\t\t\t\t\t\t\t<image :src=\"message.payload.thumbnail.url\" mode=\"aspectFit\"></image>\r\n\t\t\t\t\t\t\t<view class=\"video-play-icon\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<AudioPlayer v-if=\"message.type == 'audio'\" :src=\"message.payload.url\" :duration=\"message.payload.duration\" />\r\n\t\t\t\t\t\t<view class=\"custom-message\" v-if=\"message.type == 'order'\">\r\n\t\t\t\t\t\t\t<view class=\"title\"><text>自定义消息</text></view>\r\n\t\t\t\t\t\t\t<view class=\"custom-message-item\">编号：{{ message.payload.number }}</view>\r\n\t\t\t\t\t\t\t<view class=\"custom-message-item\">商品: {{ message.payload.goods }}</view>\r\n\t\t\t\t\t\t\t<view class=\"custom-message-item\">金额: {{ message.payload.price }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"action-box\" v-if=\"!video.visible\">\r\n\t\t\t<view class=\"action-top\">\r\n\t\t\t\t<view :class=\"[audio.visible ? 'record-icon record-open' : 'record-icon']\" @click=\"switchAudioKeyboard\"></view>\r\n\t\t\t\t<view class=\"record-input\" @touchstart=\"onRecordStart\" @touchend=\"onRecordEnd\" v-if=\"audio.visible\">{{ audio.recording ? '松开发送' : '按住录音' }}</view>\r\n\t\t\t\t<view class=\"message-input\" v-else><input type=\"text\" maxlength=\"700\" placeholder=\"发送消息\" v-model=\"content\" @focus=\"messageInputFocusin\" /></view>\r\n\t\t\t\t<view class=\"file-icon emoji-icon\" @click=\"showEmoji\"></view>\r\n\t\t\t\t<view class=\"file-icon more-icon\" @click=\"showMore\"></view>\r\n\t\t\t\t<span class=\"send-message-btn\" @click=\"sendTextMessage\">发送</span>\r\n\t\t\t</view>\r\n\t\t\t<!--展示表情列表-->\r\n\t\t\t<view class=\"action-bottom\" v-if=\"emoji.show\" style=\"justify-content: space-around\">\r\n\t\t\t\t<image class=\"emoji-item\" v-for=\"(emojiItem, emojiKey, index) in emoji.map\" :key=\"index\" :src=\"emoji.url + emojiItem\" @click=\"selectEmoji(emojiKey)\"></image>\r\n\t\t\t</view>\r\n\t\t\t<!--更多-->\r\n\t\t\t<view class=\"action-bottom\" v-if=\"more.show\">\r\n\t\t\t\t<view class=\"more-item\" @click=\"sendImage\">\r\n\t\t\t\t\t<image src=\"/static/image/chat/tupian.png\"></image>\r\n\t\t\t\t\t<text>图片</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"more-item\" @click=\"sendVideo\">\r\n\t\t\t\t\t<image src=\"/static/image/chat/shipin.png\"></image>\r\n\t\t\t\t\t<text>视频</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"record-loading\" v-if=\"audio.recording\"></view>\r\n\t\t<video v-if=\"video.visible\" :src=\"video.url\" id=\"videoPlayer\" @fullscreenchange=\"onVideoFullScreenChange\"></video>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport AudioPlayer from '../../../components/AudioPlayer/AudioPlayer';\r\nimport EmojiDecoder from '../../../common/EmojiDecoder';\r\nconst recorderManager = uni.getRecorderManager();\r\n\r\nexport default {\r\n\tname: 'privateChat',\r\n\tcomponents: {\r\n\t\tAudioPlayer\r\n\t},\r\n\tdata() {\r\n\t\tlet emojiUrl = 'https://imgcache.qq.com/open/qcloud/tim/assets/emoji/';\r\n\t\tlet emojiMap = {\r\n\t\t\t'[么么哒]': 'emoji_3@2x.png',\r\n\t\t\t'[乒乓]': 'emoji_4@2x.png',\r\n\t\t\t'[便便]': 'emoji_5@2x.png',\r\n\t\t\t'[信封]': 'emoji_6@2x.png',\r\n\t\t\t'[偷笑]': 'emoji_7@2x.png',\r\n\t\t\t'[傲慢]': 'emoji_8@2x.png'\r\n\t\t};\r\n\t\treturn {\r\n\t\t\t//聊天文本框\r\n\t\t\tcontent: '',\r\n\t\t\tfriend: null,\r\n\t\t\tcurrentUser: null,\r\n\t\t\t//已经接收到的消息\r\n\t\t\tmessages: [],\r\n\t\t\t//已经加载完所有历史消息\r\n\t\t\tallHistoryLoaded: false,\r\n\r\n\t\t\t//定义表情列表\r\n\t\t\temoji: {\r\n\t\t\t\turl: emojiUrl,\r\n\t\t\t\tmap: emojiMap,\r\n\t\t\t\tshow: false,\r\n\t\t\t\tdecoder: new EmojiDecoder(emojiUrl, emojiMap)\r\n\t\t\t},\r\n\t\t\tmore: {\r\n\t\t\t\t//更多按钮\r\n\t\t\t\tshow: false\r\n\t\t\t},\r\n\t\t\taudio: {\r\n\t\t\t\t//语音录音中\r\n\t\t\t\trecording: false,\r\n\t\t\t\t//录音按钮展示\r\n\t\t\t\tvisible: false\r\n\t\t\t},\r\n\t\t\tvideo: {\r\n\t\t\t\tvisible: false,\r\n\t\t\t\turl: '',\r\n\t\t\t\tcontext: null\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tonReady() {\r\n\t\tthis.video.context = uni.createVideoContext('videoPlayer', this);\r\n\t\t// https://uniapp.dcloud.io/api/ui/navigationbar?id=setnavigationbartitle\r\n\t\t/* \t\tuni.setNavigationBarTitle({\n\t\t\ttitle: this.friend.name\n\t\t}); */\r\n\t},\r\n\tonShow() {\r\n\t\tthis.more.show = false;\r\n\t\tthis.emoji.show = false;\r\n\t},\r\n\t/* \tonLoad(options) {\n\t\tlet imService = getApp().globalData.imService;\n\t\tthis.currentUser = uni.getStorageSync('currentUser');\n\t\t//聊天对象\n\t\tlet friendId = options.to;\n\t\t//从服务器获取最新的好友信息\n\t\tthis.friend = imService.findFriendById(friendId);\n\t\tconsole.log('onLoad friend - ', this.friend);\n\t\tthis.messages = imService.getPrivateMessages(friendId);\n\t\t//监听新消息\n\t\timService.onNewPrivateMessageReceive = (friendId, message) => {\n\t\t\tif (friendId === this.friend.uuid) {\n\t\t\t\t//聊天时，收到消息标记为已读\n\t\t\t\tthis.markPrivateMessageAsRead(friendId);\n\t\t\t\t//收到新消息，是滚动到最底部\n\t\t\t\tthis.scrollToBottom();\n\t\t\t}\n\t\t};\n\t\t//每次进入聊天页面，总是滚动到底部\n\t\tthis.scrollToBottom();\n\t\t// 录音监听器\n\t\tthis.initRecorderListeners();\n\t\t//收到的消息设置为已读\n\t\tif (this.messages.length !== 0) {\n\t\t\tthis.markPrivateMessageAsRead(friendId);\n\t\t}\n\t} ,*/\r\n\tonPullDownRefresh(e) {\r\n\t\tthis.loadMoreHistoryMessage();\r\n\t},\r\n\tonUnload() {\r\n\t\t//退出聊天页面之前，清空页面传入的监听器\r\n\t\tlet imService = getApp().globalData.imService;\r\n\t\tif (imService) {\r\n\t\t\timService.onNewPrivateMessageReceive = (friendId, message) => {};\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t//渲染文本消息，如果包含表情，替换为图片\r\n\t\t//todo:本不需要该方法，可以在标签里完成，但小程序有兼容性问题，被迫这样实现\r\n\t\trenderTextMessage(message) {\r\n\t\t\treturn '<span class=\"text-content\">' + this.emoji.decoder.decode(message.payload.text) + '</span>';\r\n\t\t},\r\n\t\t//像微信那样显示时间，如果有几分钟没发消息了，才显示时间\r\n\t\t//todo:本不需要该方法，可以在标签里完成，但小程序有兼容性问题，被迫这样实现\r\n\t\trenderMessageDate(message, index) {\r\n\t\t\tif (index === 0) {\r\n\t\t\t\treturn this.formatDate(message.timestamp);\r\n\t\t\t} else {\r\n\t\t\t\tif (message.timestamp - this.messages[index - 1].timestamp > 5 * 60 * 1000) {\r\n\t\t\t\t\treturn this.formatDate(message.timestamp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\tinitRecorderListeners() {\r\n\t\t\t// 监听录音开始\r\n\t\t\trecorderManager.onStart(() => {\r\n\t\t\t\tthis.audio.recording = true;\r\n\t\t\t});\r\n\t\t\t//录音结束后，发送\r\n\t\t\trecorderManager.onStop(res => {\r\n\t\t\t\tthis.audio.recording = false;\r\n\t\t\t\tlet audioMessage = this.goEasy.im.createAudioMessage({\r\n\t\t\t\t\tto: {\r\n\t\t\t\t\t\tid: this.friend.uuid,\r\n\t\t\t\t\t\ttype: this.GoEasy.IM_SCENE.PRIVATE,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tname: this.friend.name,\r\n\t\t\t\t\t\t\tavatar: this.friend.avatar\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfile: res,\r\n\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\tconsole.log(progress);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\ttitle: this.currentUser.name + '发来一段语音',\r\n\t\t\t\t\t\tbody: '[语音消息]' // 字段最长 50 字符\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.sendMessage(audioMessage);\r\n\t\t\t});\r\n\t\t\t// 监听录音报错\r\n\t\t\trecorderManager.onError(function(res) {\r\n\t\t\t\tconsole.log('录音报错：', res);\r\n\t\t\t});\r\n\t\t},\r\n\t\tsendMessage(message) {\r\n\t\t\tlet toId = message.to.id;\r\n\t\t\tlet imService = getApp().globalData.imService;\r\n\t\t\tlet localHistory = imService.getPrivateMessages(toId);\r\n\t\t\tlocalHistory.push(message);\r\n\t\t\tthis.goEasy.im.sendMessage({\r\n\t\t\t\tmessage: message,\r\n\t\t\t\tonSuccess: function(message) {\r\n\t\t\t\t\tconsole.log('发送成功.', message);\r\n\t\t\t\t},\r\n\t\t\t\tonFailed: function(error) {\r\n\t\t\t\t\tconsole.log('发送失败:', error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tsendTextMessage() {\r\n\t\t\t//发送消息\r\n\t\t\tif (this.content.trim() !== '') {\r\n\t\t\t\tlet body = this.content;\r\n\t\t\t\tif (this.content.length >= 50) {\r\n\t\t\t\t\tbody = this.content.substring(0, 30) + '...';\r\n\t\t\t\t}\r\n\t\t\t\tlet textMessage = this.goEasy.im.createTextMessage({\r\n\t\t\t\t\ttext: this.content,\r\n\t\t\t\t\tto: {\r\n\t\t\t\t\t\tid: this.friend.uuid,\r\n\t\t\t\t\t\ttype: this.GoEasy.IM_SCENE.PRIVATE,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tname: this.friend.name,\r\n\t\t\t\t\t\t\tavatar: this.friend.avatar\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\ttitle: this.currentUser.name + '发来一段文字',\r\n\t\t\t\t\t\tbody: body\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.sendMessage(textMessage);\r\n\t\t\t}\r\n\t\t\tthis.scrollToBottom();\r\n\t\t\tthis.content = '';\r\n\t\t},\r\n\t\tloadMoreHistoryMessage() {\r\n\t\t\t//历史消息\r\n\t\t\tlet self = this;\r\n\t\t\tlet lastMessageTimeStamp = Date.now();\r\n\t\t\tlet lastMessage = this.messages[0];\r\n\t\t\tif (lastMessage) {\r\n\t\t\t\tlastMessageTimeStamp = lastMessage.timestamp;\r\n\t\t\t}\r\n\t\t\tlet currentLength = this.messages.length;\r\n\t\t\tthis.goEasy.im.history({\r\n\t\t\t\tuserId: self.friend.uuid,\r\n\t\t\t\tlastTimestamp: lastMessageTimeStamp,\r\n\t\t\t\tonSuccess: function(result) {\r\n\t\t\t\t\t//获取本地记录\r\n\t\t\t\t\tlet imService = getApp().globalData.imService;\r\n\t\t\t\t\tlet localHistory = imService.getPrivateMessages(self.friend.uuid);\r\n\t\t\t\t\t//添加加载的记录到本地记录尾部\r\n\t\t\t\t\tlet messages = result.content;\r\n\t\t\t\t\tfor (let i = messages.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tlocalHistory.unshift(messages[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (localHistory.length === currentLength) {\r\n\t\t\t\t\t\tself.allHistoryLoaded = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.messages = localHistory;\r\n\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t},\r\n\t\t\t\tonFailed: function(error) {\r\n\t\t\t\t\t//获取失败\r\n\t\t\t\t\tif (error.code === 401) {\r\n\t\t\t\t\t\tconsole.log('获取历史消息失败,默认不开通，付费应用，可以在我的应用->查看详情，高级功能里自助开通');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('获取历史消息失败, code:' + error.code + ',错误信息:' + error.content);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//语音录制按钮和键盘输入的切换\r\n\t\tswitchAudioKeyboard() {\r\n\t\t\tthis.audio.visible = !this.audio.visible;\r\n\t\t\tif (uni.authorize) {\r\n\t\t\t\tuni.authorize({\r\n\t\t\t\t\tscope: 'scope.record'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonRecordStart() {\r\n\t\t\ttry {\r\n\t\t\t\trecorderManager.start();\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '录音错误',\r\n\t\t\t\t\tcontent: '请在app和小程序端体验录音，Uni官方明确H5不支持getRecorderManager, 详情查看Uni官方文档'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonRecordEnd() {\r\n\t\t\ttry {\r\n\t\t\t\trecorderManager.stop();\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\tsendVideo() {\r\n\t\t\t//发送文件\r\n\t\t\tuni.chooseVideo({\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tlet videoMessage = this.goEasy.im.createVideoMessage({\r\n\t\t\t\t\t\tto: {\r\n\t\t\t\t\t\t\tid: this.friend.uuid,\r\n\t\t\t\t\t\t\ttype: this.GoEasy.IM_SCENE.PRIVATE,\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tname: this.friend.name,\r\n\t\t\t\t\t\t\t\tavatar: this.friend.avatar\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfile: res,\r\n\t\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\t\tconsole.log(progress);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\ttitle: this.currentUser.name + '发来一个视频',\r\n\t\t\t\t\t\t\tbody: '[视频消息]' // 字段最长 50 字符\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.sendMessage(videoMessage);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tsendImage() {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tlet imageMessage = this.goEasy.im.createImageMessage({\r\n\t\t\t\t\t\tto: {\r\n\t\t\t\t\t\t\tid: this.friend.uuid,\r\n\t\t\t\t\t\t\ttype: this.GoEasy.IM_SCENE.PRIVATE,\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tname: this.friend.name,\r\n\t\t\t\t\t\t\t\tavatar: this.friend.avatar\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfile: res,\r\n\t\t\t\t\t\tonProgress: function(progress) {\r\n\t\t\t\t\t\t\tconsole.log(progress);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tnotification: {\r\n\t\t\t\t\t\t\ttitle: this.currentUser.name + '发来一张图片',\r\n\t\t\t\t\t\t\tbody: '[图片消息]' // 字段最长 50 字符\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.sendMessage(imageMessage);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tshowImageFullScreen(e) {\r\n\t\t\tvar imagesUrl = [e.currentTarget.dataset.url];\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: imagesUrl\r\n\t\t\t});\r\n\t\t},\r\n\t\tplayVideo(e) {\r\n\t\t\tthis.video.visible = true;\r\n\t\t\tthis.video.url = e.currentTarget.dataset.url;\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.video.context.requestFullScreen({\r\n\t\t\t\t\tdirection: 0\r\n\t\t\t\t});\r\n\t\t\t\tthis.video.context.play();\r\n\t\t\t});\r\n\t\t},\r\n\t\tonVideoFullScreenChange(e) {\r\n\t\t\t//当退出全屏播放时，隐藏播放器\r\n\t\t\tif (this.video.visible && !e.detail.fullScreen) {\r\n\t\t\t\tthis.video.visible = false;\r\n\t\t\t\tthis.video.context.stop();\r\n\t\t\t}\r\n\t\t},\r\n\t\tmessageInputFocusin() {\r\n\t\t\tthis.more.show = false;\r\n\t\t\tthis.emoji.show = false;\r\n\t\t},\r\n\t\tshowEmoji() {\r\n\t\t\tthis.emoji.show = !this.emoji.show;\r\n\t\t\tthis.more.show = false;\r\n\t\t},\r\n\t\tshowMore() {\r\n\t\t\tthis.more.show = !this.more.show;\r\n\t\t\tthis.emoji.show = false;\r\n\t\t},\r\n\t\tselectEmoji(emojiKey) {\r\n\t\t\tthis.content += emojiKey;\r\n\t\t},\r\n\t\tshowCustomMessageForm() {\r\n\t\t\tlet to = {\r\n\t\t\t\tid: this.friend.uuid,\r\n\t\t\t\tname: this.friend.name,\r\n\t\t\t\tavatar: this.friend.avatar,\r\n\t\t\t\ttype: this.GoEasy.IM_SCENE.PRIVATE\r\n\t\t\t};\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '../customMessage/customMessage?to=' + JSON.stringify(to)\r\n\t\t\t});\r\n\t\t},\r\n\t\tscrollToBottom() {\r\n\t\t\tthis.$nextTick(function() {\r\n\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\tscrollTop: 2000000,\r\n\t\t\t\t\tduration: 10\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tmarkPrivateMessageAsRead(friendId) {\r\n\t\t\tthis.goEasy.im.markPrivateMessageAsRead({\r\n\t\t\t\tuserId: friendId,\r\n\t\t\t\tonSuccess: function() {\r\n\t\t\t\t\tconsole.log('标记为已读成功');\r\n\t\t\t\t},\r\n\t\t\t\tonFailed: function(error) {\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style>\r\n@import url('@/static/css/chat/chatInterface.css');\r\n</style>\n","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1646701817551\n      var cssReload = require(\"C:/Users/IT/Desktop/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}